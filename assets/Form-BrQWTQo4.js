import{r as c,j as e}from"./index-WBWvA29f.js";import{c as M,fo as O,fI as v,eQ as R,et as z,eM as H,g4 as J,g2 as $,g3 as U}from"./index-BUNkcYdj.js";const X=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],Q=M("circle-plus",X);const Z=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M2 10h20",key:"1ir3d8"}]],B=M("folder-closed",Z);const G=[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v.5",key:"1dkoa9"}],["path",{d:"M12 10v4h4",key:"1czhmt"}],["path",{d:"m12 14 1.535-1.605a5 5 0 0 1 8 1.5",key:"lvuxfi"}],["path",{d:"M22 22v-4h-4",key:"1ewp4q"}],["path",{d:"m22 18-1.535 1.605a5 5 0 0 1-8-1.5",key:"14ync0"}]],K=M("folder-sync",G);const W=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Y=M("square-x",W),F=[{value:"contract",label:"契約中"},{value:"negotiation",label:"商談中"},{value:"cancellation",label:"解約"}],ce={contract:"契約中",negotiation:"商談中",cancellation:"解約",initial:"未設定"},V=[{label:"会社名",type:"text",name:"company",id:"company"},{label:"郵便番号",type:"text",name:"postalCode",id:"postalCode"},{label:"都道府県",type:"text",name:"prefecture",id:"prefecture"},{label:"市区町村",type:"text",name:"city",id:"city"},{label:"その他の住所",type:"text",name:"address",id:"address"},{label:"アパートマンション名",type:"text",name:"building",id:"building"},{label:"電話番号",type:"text",name:"tel",id:"tel"},{label:"メールアドレス",type:"text",name:"emails",id:"emails"},{label:"契約日",type:"date",name:"contractDate",id:"contractDate"}],ee=["東京都","北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"];function te(s){const{autoFetch:h=!1}=s||{},[l,x]=c.useState([]),[r,p]=c.useState(!1),[b,f]=c.useState(!1),[S,n]=c.useState(!1),[N,E]=c.useState(null),o=c.useCallback(async()=>{p(!0),E(null);try{const m=await(await fetch("http://localhost:3001/api/data")).json();return m.success?(x(m.data),m.data):(E("データの取得に失敗しました"),null)}catch(a){return console.error("取得エラー:",a),E("サーバーとの通信に失敗しました"),null}finally{p(!1)}},[]),i=c.useCallback(async(a,m)=>{f(!0);try{const g=await fetch(`http://localhost:3001/api/data/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),y=await g.json();if(!g.ok||!y.success)throw new Error(y.error||"更新に失敗しました");const k=y.data;return x(I=>I.map(_=>_.id===a?k:_)),k}finally{f(!1)}},[]),d=c.useCallback(async a=>{n(!0);try{const m=await fetch(`http://localhost:3001/api/data/${a}`,{method:"DELETE"}),g=await m.json();if(!m.ok||!g.success)throw new Error(g.error||"削除に失敗しました");return x(y=>y.filter(k=>k.id!==a)),g.data}finally{n(!1)}},[]);return c.useEffect(()=>{h&&o()},[h,o]),{dataList:l,isLoading:r,isUpdating:b,isDeleting:S,error:N,fetchData:o,updateData:i,deleteData:d}}function P(s){return e.jsxs("div",{className:"mb-1",children:[e.jsx("label",{className:"block",htmlFor:s.name,children:s.label}),e.jsx("input",{type:s.type,name:s.name,id:s.id,className:`\r
          w-full py-2 border-2 border-indigo-500 rounded-sm \r
          focus:outline-1 focus:outline-indigo-700\r
        `,value:s.value,onChange:s.onChange})]})}const ae=R(["initial","contract","negotiation","cancellation"]),se=O({company:v().trim().trim().min(1,"会社名を入力してください"),postalCode:v().trim().regex(/^\d{3}-?\d{4}$/,"郵便番号は「1234567」または「123-4567」の形式で入力してください"),prefecture:v().trim().min(1,"都道府県を入力してください"),city:v().trim().min(1,"市区町村を入力してください"),address:v().trim().min(1,"残りの住所を入力してください"),building:v().trim().optional(),tel:v().trim().min(1,"電話番号を入力してください").regex(/^[0-9\-+\s()]{7,20}$/,"電話番号の形式が不正です"),emails:z(H("正しいメールアドレスを入力してください")).min(1,"最低1つのメールアドレスを入力してください").refine(s=>s.some(h=>h.trim()!==""),"最低1つのメールアドレスを入力してください"),contractDate:v().trim().min(1,"日付を入力してください"),contractStatus:ae.refine(s=>s!=="initial",{message:"契約ステータスを選択してください"}),cancellationDate:v().trim().optional()}).refine(s=>s.contractStatus==="cancellation"?s.cancellationDate&&s.cancellationDate.length>0:!0,{message:"解約日を入力してください",path:["cancellationDate"]}),A={company:"",postalCode:"",prefecture:"",city:"",address:"",building:"",tel:"",emails:[""],contractDate:"",contractStatus:"initial",cancellationDate:""},ne=s=>{const[h,l]=c.useState(s??A),[x,r]=c.useState({}),[p,b]=c.useState([]);return c.useEffect(()=>{l(s??A),r({}),b([])},[s]),{data:h,setData:l,errors:x,setErrors:r,emailErrors:p,setEmailErrors:b,handleChange:o=>{const{name:i,value:d}=o.target;l(a=>({...a,[i]:d})),x[i]&&r(a=>{const m={...a};return delete m[i],m})},handleEmailChange:(o,i)=>{l(d=>{const a=[...d.emails];return a[o]=i,{...d,emails:a}}),b(d=>{const a=[...d];return a[o]="",a}),r(d=>{const a={...d};return delete a.emails,a})},handleAddEmail:()=>{l(o=>({...o,emails:[...o.emails,""]}))},handleRemoveEmail:o=>{h.emails.length>1&&(l(i=>({...i,emails:i.emails.filter((d,a)=>a!==o)})),b(i=>i.filter((d,a)=>a!==o)))},resetForm:()=>{l(s??A),r({}),b([])}}};function re(s){const[h,l]=c.useState(!1),{dataList:x,isLoading:r,error:p,fetchData:b}=te(),f=async()=>{await b(),l(!0)},S=n=>{s.onLoadData({company:n.company||"",postalCode:n.postalCode||"",prefecture:n.prefecture||"",city:n.city||"",address:n.address||"",building:n.building||"",tel:n.tel||"",emails:n.emails||[""],contractDate:n.contractDate||"",contractStatus:n.contractStatus||"initial",cancellationDate:n.cancellationDate||""}),l(!1)};return e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex justify-end mb-2",children:h?e.jsxs("button",{type:"button",onClick:()=>l(!1),className:`\r
            bg-rose-50 hover:bg-rose-200 transition-all w-60\r
            text-lg px-4 py-2 border-2 border-rose-500 rounded-sm\r
            disabled:opacity-50 disabled:cursor-not-allowed\r
          `,children:[e.jsx(B,{className:"inline-block align-text-top mr-2 text-gray-600"}),"保存データを閉じる"]}):e.jsxs("button",{type:"button",onClick:f,disabled:r,className:`\r
            bg-blue-50 hover:bg-blue-100 transition-all w-60\r
            text-lg px-4 py-2 border-2 border-blue-500 rounded-sm\r
            disabled:opacity-50 disabled:cursor-not-allowed\r
          `,children:[e.jsx(K,{className:"inline-block align-text-top mr-2 text-gray-600"}),"保存データを読み込む"]})}),p&&e.jsx("div",{className:"text-red-500 text-center mb-2",children:p}),h&&e.jsxs("div",{className:`\r
            mt-4 border-2 border-gray-300 rounded p-4 \r
            bg-white shadow-lg max-h-96 overflow-y-auto\r
          `,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-xl font-bold",children:"保存されたデータ一覧"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:`\r
                text-gray-700 bg-rose-50 hover:bg-rose-200 transition-colors \r
                rounded cursor-pointer inline-block align-text-top\r
                text-2xl font-bold w-8 h-8\r
              `,children:e.jsx(Y,{className:"m-auto "})})]}),x.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"保存されたデータがありません"}):e.jsx("ul",{className:"space-y-2",children:x.map(n=>e.jsxs("li",{onClick:()=>S(n),className:`\r
                    border border-gray-200 rounded p-3 \r
                    cursor-pointer hover:bg-blue-50 \r
                    transition-colors\r
                  `,children:[e.jsxs("div",{className:"text-sm mb-1",children:[e.jsx("span",{className:"font-semibold",children:"会社名:"})," ",n.company]}),e.jsxs("div",{className:"text-sm mb-1",children:[e.jsx("span",{className:"font-semibold",children:"メール:"})," ",n.emails.join(", ")]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["作成日: ",new Date(n.createdAt).toLocaleString("ja-JP")]}),e.jsx("div",{className:"text-xs text-blue-600 mt-2",children:"クリックして読み込む"})]},n.id))})]})]})}function ie({initialValues:s,onSubmit:h,submitLabel:l="送信する",mode:x="create"}){const{data:r,setData:p,errors:b,setErrors:f,emailErrors:S,setEmailErrors:n,handleChange:N,handleEmailChange:E,handleAddEmail:o,handleRemoveEmail:i,resetForm:d}=ne(s),[a,m]=c.useState(!1),[g,y]=c.useState(!1),k=async t=>{t.preventDefault(),f({}),n([]),y(!0);const u=r.emails.filter(w=>w.trim()!==""),j={...r,emails:u.length>0?u:[""]},C=se.safeParse(j);if(!C.success){const w={},D=[];C.error.issues.forEach(L=>{const T=L.path[0];if(T==="emails"&&L.path.length>1){const q=L.path[1];D[q]=L.message}else w[T]=L.message}),f(w),n(D),y(!1);return}try{if(h)await h(C.data);else{const D=await(await fetch("http://localhost:3001/api/data",{method:"POST",headers:{"content-Type":"application/json"},body:JSON.stringify(C.data)})).json();D.success&&(console.log("送信成功:",D.data),d())}}catch(w){console.error("送信エラー:",w)}finally{y(!1)}},I=async()=>{f({});try{m(!0);const t=await U(r.postalCode);t&&p(u=>({...u,prefecture:t.address1,city:t.address2,address:t.address3}))}catch(t){console.log(t),f(u=>({...u,postalCode:"住所の取得に失敗しました"}))}finally{m(!1)}},_=t=>{p(t)};return e.jsxs("div",{className:"w-150 mx-auto bg-neutral-50 py-6 px-10 rounded-2xl",children:[x==="create"&&e.jsx(re,{onLoadData:_}),e.jsxs("form",{className:"max-w-full text-xl",onSubmit:k,children:[V.map(t=>e.jsxs("div",{children:[t.name==="prefecture"?e.jsxs("div",{className:"mb-1",children:[e.jsx("label",{className:"block",htmlFor:"contractStatus",children:t.label}),e.jsxs("select",{className:`\r
                  w-full py-2 border-2 border-indigo-500 rounded-sm \r
                  focus:outline-1 focus:outline-indigo-700\r
                `,id:t.id,name:t.name,value:r.prefecture,onChange:N,children:[e.jsx("option",{value:"",children:"---- 選択してください ----"}),ee.map(u=>e.jsx("option",{value:u,children:u},u))]})]}):t.name==="emails"?e.jsxs("div",{children:[r.emails.map((u,j)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx(P,{label:j===0?t.label:"",type:t.type,name:`${t.name}_${j}`,id:`${t.id}_${j}`,value:u,onChange:C=>E(j,C.target.value)})}),r.emails.length>1&&e.jsx("button",{type:"button",onClick:()=>i(j),className:"rounded-full bg-red-100 hover:bg-red-200 w-10 h-10 mb-1 transition-colors",children:e.jsx(J,{className:"m-auto text-red-700"})})]}),e.jsx($,{message:S[j],className:"min-h-0 mt-0"})]},j)),e.jsx("div",{className:"grid place-content-center mb-2",children:e.jsx("button",{type:"button",onClick:o,className:"rounded-full bg-neutral-200 hover:bg-neutral-300 w-10 h-10 transition-colors",children:e.jsx(Q,{className:"m-auto"})})})]}):e.jsx(P,{label:t.label,type:t.type,name:t.name,id:t.id,value:r[t.name]??"",onChange:N}),e.jsx($,{message:b[t.name]}),t.name==="postalCode"&&e.jsx("div",{className:"flex flex-row-reverse",children:e.jsx("button",{type:"button",onClick:I,disabled:a,className:`\r
                    bg-white hover:bg-neutral-200 transition-all\r
                    w-60 text-base px-5 py-2 border rounded-sm\r
                  `,children:a?"入力中...":"郵便番号から住所を自動入力"})})]},t.id)),e.jsxs("div",{className:"mb-1",children:[e.jsx("label",{className:"block",htmlFor:"contractStatus",children:"契約状態"}),e.jsxs("select",{className:`\r
              w-full py-2 border-2 border-indigo-500 rounded-sm \r
              focus:outline-1 focus:outline-indigo-700\r
            `,id:"contractStatus",name:"contractStatus",value:r.contractStatus,onChange:N,children:[e.jsx("option",{value:"",children:"---- 選択してください ----"}),F.map(({value:t,label:u})=>e.jsx("option",{value:t,children:u},t))]})]}),e.jsx($,{message:b.contractStatus}),r.contractStatus==="cancellation"&&e.jsxs("div",{children:[e.jsx("label",{className:"block",htmlFor:"cancellationDate",children:"解約日"}),e.jsx("input",{type:"date",id:"cancellationDate",name:"cancellationDate",value:r.cancellationDate,onChange:N,className:`\r
                w-full py-2 border-2 border-indigo-500 rounded-sm \r
                focus:outline-1 focus:outline-indigo-700\r
              `}),e.jsx($,{message:b.cancellationDate})]}),e.jsx("button",{type:"submit",disabled:g,className:`\r
            bg-white hover:bg-neutral-200 transition-all\r
              text-lg w-50 px-8 py-4 border rounded-sm block mx-auto mt-2\r
            `,children:g?"送信中...":l})]})]})}export{ie as F,ce as c,te as u};
