import{c as w,r as n,u as R,j as e}from"./index-Bi52q8ka.js";import{T as C,a as q,b as v,c as o,d as I,e as c}from"./table-VnKWdUwq.js";import"./utils-D6nKrteA.js";import"./bundle-mjs-COJ8Fh6m.js";const L=l=>l.reduce((d,s)=>{const x=Math.round(s.unitPrice/(1+s.taxRate/100));return d+s.qty*x},0),J=l=>l.reduce((d,s)=>d+s.qty*s.unitPrice,0);function k(){const{order:l,items:d}=w.useLoaderData(),[s,x]=n.useState(d),[m,i]=n.useState(null),[j,b]=n.useState(!1),N=R(),p=n.useRef(null),h=n.useMemo(()=>L(s),[s]),g=n.useMemo(()=>J(s),[s]),y=g-h;n.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const u=(a,r,t)=>{x(S=>S.map((f,T)=>T===a?{...f,[r]:t}:f))},P=async()=>{if(s.length===0){i({type:"error",message:"商品がありません"});return}b(!0),i(null);try{const a={items:s.map(t=>({menuId:t.menuId,name:t.name,qty:t.qty,unit:t.unit,unitPrice:t.unitPrice,taxRate:t.taxRate,amount:t.qty*t.unitPrice})),subtotal:h,tax:y,total:g};if(!(await fetch(`http://localhost:3002/orders/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok){i({type:"error",message:"更新に失敗しました"});return}i({type:"success",message:"更新完了"}),p.current=setTimeout(()=>N({to:"/orderList"}),1e3)}catch(a){console.error(a),i({type:"error",message:"更新に失敗しました"})}finally{b(!1)}};return e.jsxs("div",{className:"mx-4 mt-6 text-gray-700 sm:mx-6 sm:mt-8 lg:mx-10 lg:mt-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"注文編集"}),e.jsxs("span",{className:"text-sm text-slate-500 font-bold mr-4",children:["注文ID: ",l.id]})]}),e.jsxs("div",{className:"col-span-1 rounded-3xl bg-neutral-50 px-5 py-6 sm:pt-8 xl:py-10 shadow",children:[e.jsxs(C,{children:[e.jsx(q,{children:e.jsxs(v,{children:[e.jsx(o,{children:"商品名"}),e.jsx(o,{children:"個数"}),e.jsx(o,{children:"単位"}),e.jsx(o,{children:"単価"}),e.jsx(o,{children:"税率"}),e.jsx(o,{children:"金額"})]})}),e.jsx(I,{children:s.map((a,r)=>e.jsxs(v,{children:[e.jsx(c,{children:e.jsx("input",{className:"w-full rounded-md border border-gray-300 px-2 py-1",value:a.name,onChange:t=>u(r,"name",t.target.value)})}),e.jsx(c,{children:e.jsx("input",{className:"w-20 rounded-md border border-gray-300 px-2 py-1 text-right",type:"number",min:0,value:a.qty,onChange:t=>u(r,"qty",Number(t.target.value))})}),e.jsx(c,{children:e.jsx("input",{className:"w-20 rounded-md border border-gray-300 px-2 py-1",value:a.unit,onChange:t=>u(r,"unit",t.target.value)})}),e.jsx(c,{children:e.jsx("input",{className:"w-24 rounded-md border border-gray-300 px-2 py-1 text-right",type:"number",min:0,value:a.unitPrice,onChange:t=>u(r,"unitPrice",Number(t.target.value))})}),e.jsx(c,{children:e.jsx("input",{className:"w-20 rounded-md border border-gray-300 px-2 py-1 text-right",type:"number",min:0,value:a.taxRate,onChange:t=>u(r,"taxRate",Number(t.target.value))})}),e.jsx(c,{className:"text-right",children:(a.qty*a.unitPrice).toLocaleString("ja-JP")})]},a.itemId))})]}),e.jsxs("div",{className:"mt-6 flex flex-col items-end gap-2 text-sm text-slate-600",children:[e.jsxs("div",{children:["小計: ￥",h.toLocaleString("ja-JP")]}),e.jsxs("div",{children:["税額: ￥",y.toLocaleString("ja-JP")]}),e.jsxs("div",{className:"text-base font-semibold text-slate-800",children:["合計: ￥",g.toLocaleString("ja-JP")]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-3",children:[m&&e.jsx("span",{className:m.type==="success"?"text-emerald-600":"text-red-600",children:m.message}),e.jsx("button",{type:"button",onClick:P,disabled:j,className:"rounded-md bg-indigo-600 px-6 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-70",children:j?"更新中...":"更新する"})]})]})]})}const H=k;export{H as component};
